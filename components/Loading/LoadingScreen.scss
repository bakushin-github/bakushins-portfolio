@use "../../app/styles/variables.module" as *;

$loading-bg-start: #424242;
$loading-bg-end: #424242;
$loading-text-color: #fff;
$container-max-width: 1440px;

.loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  padding-left: clamp(107px, 8vw, 120px);
  @media (max-width: 479px) {
    padding-left: clamp(68.23px, calc(8.6735vw + 40.47px), 107px);
  }
  @media (max-width: 370px) {
    padding-left: 30px;
  }
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: left;
  background: #fff;
  z-index: 9999;
  overflow: hidden;

  &::before,
  &::after {
    content: "";
    position: absolute;
    left: 0;
    width: 100%;
    height: 60vh;
    background: $loading-bg-start;
    transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    z-index: 1;
  }

  &::before {
    top: -10vh;
    transform-origin: center bottom;
  }

  &::after {
    bottom: -10vh;
    transform-origin: center top;
  }

  & > * {
    position: relative;
    z-index: 2;
  }

  &--completing {
    &::before {
      transform: translateY(-100%);
    }
    &::after {
      transform: translateY(100%);
    }
  }

  &__progress-container {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: left;
    width: 100%;
    max-width: $container-max-width;
    overflow: hidden;
    top: 50%;
    transform: translateY(-50%);

    @media (max-width: 479px) {
      position: static !important;
      width: 100% !important;
      max-width: none !important;
      transform: none !important;
      top: auto !important;
      height: auto !important;
      padding-top: 50vh !important;

      display: flex !important;
      justify-content: flex-start !important;
      align-items: center !important;
      padding-left: clamp(24px, 5vw, 40px);
    }
  }

  &__progress-display {
    display: flex;
    align-items: baseline; // ベースライン揃えに変更
    justify-content: left;
    gap: clamp(20px, 1.67vw, 24px); // 375px:20px → 1440px:24px
    flex-wrap: wrap;

    @media (max-width: 479px) {
      justify-content: flex-start !important;
      text-align: left !important;
      align-items: baseline !important; // モバイルでもベースライン揃え
    }
  }

  &__progress-number {
    color: $loading-text-color;
    // 数字部分: 375px:44px → 1440px:64px (480px-1920px対応)
    font-size: clamp(44px, 1.88vw + 36.96px, 64px);
    font-weight: 500;
    font-family: "DM Sans";
    line-height: 1;
    user-select: none;
    letter-spacing: -0.02em;
    font-feature-settings: "tnum" 1;
    animation: numberPulse 0.1s ease-out;
    display: inline-block; // inline-blockに変更

    @media (max-width: 479px) {
      font-size: 44px; // 375px幅で44px固定
      text-align: left;
      margin-bottom: 0;
      width: auto;
      line-height: 1;
    }
  }

  &__progress-percent {
    color: $loading-text-color;
    // %部分: 375px:24px → 1440px:40px (480px-1920px対応)
    font-size: clamp(24px, 1.5vw + 18.38px, 40px);
    font-weight: 500;
    font-family: "DM Sans";
    line-height: 1;
    user-select: none;
    letter-spacing: -0.02em;
    font-feature-settings: "tnum" 1;
    display: inline-block; // inline-blockに変更してベースライン揃えが効くように
    margin-left: -12px; // 数字との間隔をもっと詰める

    @media (max-width: 479px) {
      font-size: 24px; // 375px幅で24px固定
      text-align: left;
      margin-bottom: 0;
      width: auto;
      line-height: 1;
      margin-left: -10px; // モバイルでももっと詰める
    }
  }

  &__logo {
    display: flex;
    align-items: baseline; // ベースライン揃えに変更
    justify-content: center;
    opacity: 0;
    transform: translateY(-50px);
    animation: logoSlideDown 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;

    img {
      display: block;
      // ロゴサイズ: 375px幅でwidth:140px, height:39px → 1440px幅でもう少し大きく
      // 140/39 = 約3.59の比率を維持
      width: clamp(140px, 10.38vw + 20.72px, 220px);
      height: clamp(39px, 2.71vw + 9.01px, 61px);

      max-width: none;
      max-height: none;

      @media (max-width: 479px) {
        width: 140px;
        height: 39px;
        margin: 0;
      }
    }
  }
}

@keyframes numberPulse {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.02);
  }
  100% {
    transform: scale(1);
  }
}

@keyframes logoSlideDown {
  0% {
    opacity: 0;
    transform: translateY(-50px);
  }
  60% {
    opacity: 0.8;
    transform: translateY(5px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

.loading-screen,
.loading-screen__progress-number,
.loading-screen__logo {
  will-change: transform, opacity;
}

.loading-screen {
  font-display: swap;
}

@media (prefers-contrast: high) {
  .loading-screen {
    background: #000;
    &__progress-number {
      color: #fff;
      text-shadow: none;
    }
  }
}

@media (prefers-reduced-motion: reduce) {
  .loading-screen {
    transition-duration: 0.01ms;
    &__logo {
      animation: none;
      opacity: 1;
      transform: translateY(0);
      img {
        transform: none !important;
      }
    }
  }

  @keyframes numberPulse {
    0%,
    100% {
      transform: scale(1);
    }
  }

  @keyframes logoSlideDown {
    0%,
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }
}
